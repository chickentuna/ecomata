(this.webpackJsonpecomata=this.webpackJsonpecomata||[]).push([[0],{21:function(t,e,i){t.exports=i(38)},26:function(t,e,i){},27:function(t,e,i){},38:function(t,e,i){"use strict";i.r(e);var a=i(0),n=i.n(a),r=i(16),o=i.n(r),l=(i(26),i(7)),s=i(2),h=i(3),c=i(20),u=i(18),d=(i(27),i(1)),v=i(5),f=10*Math.sqrt(3);function p(t){var e=Math.round(t.x/15);return{x:e,y:e%2?Math.floor(t.y/f):Math.round(t.y/f)}}var b=[[[1,0],[1,-1],[0,-1],[-1,-1],[-1,0],[0,1]],[[1,1],[1,0],[0,-1],[-1,0],[-1,1],[0,1]]];function y(t,e,i){var a=b[1&t][i];return{x:t+a[0],y:e+a[1]}}function w(t){var e=t.x,i=t.y-(t.x-(1&t.x))/2;return{x:e,y:-e-i,z:i}}function m(t,e){return function(t,e){return(Math.abs(t.x-e.x)+Math.abs(t.y-e.y)+Math.abs(t.z-e.z))/2}(w(t),w(e))}var g=i(12);i(19);function x(t){return 1===t.length?t[0]:t[(e=0,i=t.length,Math.floor(e+Math.random()*(i-e)))];var e,i}var k=[];function j(t){return k.filter(t).length}function C(t){return j((function(e){return e.animal===t}))}var O={fish:{habitat:"ocean"},shark:{habitat:"ocean",prey:["fish"]},crab:{habitat:"sand"},octopus:{habitat:"ocean",prey:["crab"]},bird:{habitat:["rock","earth"],prey:["crab","bug"]},bug:{habitat:"earth"}},M=function(){function t(){Object(s.a)(this,t)}return Object(h.a)(t,null,[{key:"tick",value:function(t,e,i){k=e;var a=[];if(function(t,e){var i=!1;if(Object.entries(O).forEach((function(a){var n,r=Object(l.a)(a,2),o=r[0],s=r[1],h=C(o),c=null===(n=s.prey)||void 0===n?void 0:n.includes(t.animal),u=null==t.animal,d=s.prey&&j((function(t){return s.prey.includes(t.animal)})),v="string"===typeof s.habitat?t.type===s.habitat:s.habitat.includes(t.type);2===h&&(c||u&&v)&&(null==d||d>0)&&(e({animal:o}),i=!0)})),!i&&null!=t.animal){var a=O[t.animal],n=C(t.animal),r=a.prey&&j((function(t){return a.prey.includes(t.animal)}));if(null!=r&&0===r)e({animal:null});else if(null==r&&n<2){var o=Object.entries(O).filter((function(e){var i,a=Object(l.a)(e,2);a[0];return null===(i=a[1].prey)||void 0===i?void 0:i.includes(t.animal)})).map((function(t){var e=Object(l.a)(t,2),i=e[0];e[1];return i}));if(j((function(t){return o.includes(t.animal)}))>0)e({animal:null});else("string"===typeof a.habitat?t.type===a.habitat:a.habitat.includes(t.type))||e({animal:null})}else{("string"===typeof a.habitat?t.type===a.habitat:a.habitat.includes(t.type))||e({animal:null})}}}(t,(function(t,e){a.push({changes:t,opts:e})})),a.length>0){var n,r=x(a);if(null===(n=r.opts)||void 0===n?void 0:n.replace)return Object(g.a)(Object(g.a)({},r.changes),{},{x:t.x,y:t.y,index:t.index});var o=Object(g.a)({},t);for(var s in r.changes){var h,c=r.changes[s];"number"!==typeof c||(null===(h=r.opts)||void 0===h?void 0:h.set)?o[s]=c:o[s]=Math.max(0,Math.min(1,(t[s]||0)+c))}return o}return t}}]),t}(),D=function(){function t(){Object(s.a)(this,t),this.width=void 0,this.height=void 0,this.cells=void 0,this.neighbourMap=void 0,this.width=40,this.height=24,this.neighbourMap={},this.initGrid()}return Object(h.a)(t,[{key:"initGrid",value:function(){this.cells=[];for(var t=0,e=0;e<this.height;++e)for(var i=0;i<this.width;++i){var a={type:"void",x:i,y:e,index:t++};this.cells.push(a)}var n,r=Object(v.a)(this.cells);try{for(r.s();!(n=r.n()).done;){var o=n.value;this.neighbourMap[o.index]=this.getNeighbourIndices(o)}}catch(l){r.e(l)}finally{r.f()}}},{key:"get",value:function(t,e){return t<0||t>=this.width||e<0||e>=this.height?null:this.cells[e*this.width+t]}},{key:"setup",value:function(){this.initGrid();var t,e=Object(v.a)(this.cells);try{for(e.s();!(t=e.n()).done;){var i=t.value;if(!(0===i.y&&0===i.x||i.y===this.height-1&&i.x===this.width-1)){var a=m({x:this.width/2,y:this.height/2},i);i.type=a<=0?"rock":a<=2?"earth":a<=3?"sand":"ocean"}}}catch(n){e.e(n)}finally{e.f()}}},{key:"getNeighbourIndices",value:function(t){for(var e=[],i=0;i<6;++i){var a=y(t.x,t.y,i),n=this.get(a.x,a.y);null!=n&&e.push(n.index)}return e}},{key:"getNeighbours",value:function(t){var e,i=[],a=Object(v.a)(this.neighbourMap[t.index]);try{for(a.s();!(e=a.n()).done;){var n=e.value,r=this.cells[n];"void"!==r.type&&i.push(r)}}catch(o){a.e(o)}finally{a.f()}return i}},{key:"tick",value:function(){var t,e=[],i=Object(v.a)(this.cells);try{for(i.s();!(t=i.n()).done;){var a=t.value;if("void"!==a.type){var n=this.getNeighbours(a),r=M.tick(a,n,this);e.push(r)}else e.push(a)}}catch(o){i.e(o)}finally{i.f()}this.cells=e}}]),t}();function E(){var t=new d.b,e=new d.c,i=function(t,e,i,a){var n=new d.d(t,{fontSize:Math.round(e/1.2)+"px",fontFamily:"Lato",fontWeight:"bold",fill:i});return"right"===a?n.anchor.x=1:"center"===a&&(n.anchor.x=.5),n}("",36,16777215,"left");return this.tooltip=t,this.background=e,this.label=i,e.beginFill(0,.7),e.drawRect(0,0,100,90),e.endFill(),e.x=-10,e.y=-10,t.visible=!1,t.addChild(e),t.addChild(i),t.scale.set(.5),t.interactiveChildren=!1,t}var T=function(){function t(e,i,a){Object(s.a)(this,t),this.container=void 0,this.worldContainer=void 0,this.tooltip=void 0,this.background=void 0,this.label=void 0,this.world=void 0,this.mouseData=void 0,this.container=e,this.worldContainer=i,this.world=a}return Object(h.a)(t,[{key:"init",value:function(){var t=this;E.bind(this)(),this.worldContainer.interactive=!0,this.worldContainer.on("mousemove",(function(e){t.mouseData=e.data,t.refresh()})),this.container.addChild(this.tooltip),this.tooltip.zIndex=100}},{key:"refresh",value:function(){var t=this.tooltip;if(this.mouseData){var e=this.mouseData.getLocalPosition(this.worldContainer);t.x=e.x*this.worldContainer.scale.x,t.y=e.y*this.worldContainer.scale.y;var i=p(e),a=this.world.get(i.x,i.y),n=[];if(null!=a){var r=[];for(var o in a)null!=a[o]&&r.push("".concat(o,": ").concat(a[o]));n.push(r.join("\n"))}else if(i.y>=0&&i.x>=0&&i.x<this.world.width&&i.y<this.world.height){var l="x: "+i.x+"\ny: "+i.y;n.push(l)}t.visible=n.length>0,t.visible&&(this.label.text=n.join("\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n")),this.background.width=this.label.width+20,this.background.height=this.label.height+20,t.pivot.x=-30,t.pivot.y=-50;var s=Math.max(0,t.y+50+t.height-I);t.pivot.y+=s*this.worldContainer.scale.y;var h=Math.max(0,t.x+50+t.width-A);t.pivot.x+=h*this.worldContainer.scale.x}}}]),t}(),z={fish:"\ud83d\udc20",shark:"\ud83e\udd88",monkey:"\ud83d\udc12",gorilla:"\ud83e\udd8d",dog:"\ud83d\udc15",poodle:"\ud83d\udc29",wolf:"\ud83d\udc3a",fox:"\ud83e\udd8a",raccoon:"\ud83e\udd9d",cat:"\ud83d\udc08",lion:"\ud83e\udd81",tiger:"\ud83d\udc05",leopard:"\ud83d\udc06",horse:"\ud83d\udc0e",unicorn:"\ud83e\udd84",zebra:"\ud83e\udd93",deer:"\ud83e\udd8c",ox:"\ud83d\udc02","water buffalo":"\ud83d\udc03",cow:"\ud83d\udc04",pig:"\ud83d\udc16",boar:"\ud83d\udc17",ram:"\ud83d\udc0f",sheep:"\ud83d\udc11",goat:"\ud83d\udc10",camel:"\ud83d\udc2a",llama:"\ud83e\udd99",giraffe:"\ud83e\udd92",elephant:"\ud83d\udc18",rhinoceros:"\ud83e\udd8f",hippopotamus:"\ud83e\udd9b",mouse:"\ud83d\udc01",rat:"\ud83d\udc00",rabbit:"\ud83d\udc07",chipmunk:"\ud83d\udc3f",hedgehog:"\ud83e\udd94",bat:"\ud83e\udd87",bear:"\ud83d\udc3b",koala:"\ud83d\udc28",panda:"\ud83d\udc3c",kangaroo:"\ud83e\udd98",badger:"\ud83e\udda1",turkey:"\ud83e\udd83",chicken:"\ud83d\udc14",rooster:"\ud83d\udc13","baby chick":"\ud83d\udc24",bird:"\ud83d\udc26",penguin:"\ud83d\udc27",eagle:"\ud83e\udd85",duck:"\ud83e\udd86",swan:"\ud83e\udda2",owl:"\ud83e\udd89",peacock:"\ud83e\udd9a",parrot:"\ud83e\udd9c",frog:"\ud83d\udc38",crocodile:"\ud83d\udc0a",turtle:"\ud83d\udc22",lizard:"\ud83e\udd8e",snake:"\ud83d\udc0d",dragon:"\ud83d\udc09",sauropod:"\ud83e\udd95","t-rex":"\ud83e\udd96",whale:"\ud83d\udc33",dolphin:"\ud83d\udc2c",tuna:"\ud83d\udc1f",blowfish:"\ud83d\udc21",octopus:"\ud83d\udc19","spiral shell":"\ud83d\udc1a",snail:"\ud83d\udc0c",butterfly:"\ud83e\udd8b",bug:"\ud83d\udc1b",ant:"\ud83d\udc1c",honeybee:"\ud83d\udc1d","lady beetle":"\ud83d\udc1e",cricket:"\ud83e\udd97",spider:"\ud83d\udd77","spider web":"\ud83d\udd78",scorpion:"\ud83e\udd82",mosquito:"\ud83e\udd9f",microbe:"\ud83e\udda0",crab:"\ud83e\udd80",lobster:"\ud83e\udd9e",shrimp:"\ud83e\udd90",squid:"\ud83e\udd91"},P={bouquet:"\ud83d\udc90","cherry blossom":"\ud83c\udf38","white flower":"\ud83d\udcae",rosette:"\ud83c\udff5",rose:"\ud83c\udf39","wilted flower":"\ud83e\udd40",hibiscus:"\ud83c\udf3a",sunflower:"\ud83c\udf3b",blossom:"\ud83c\udf3c",tulip:"\ud83c\udf37",seedling:"\ud83c\udf31",pine:"\ud83c\udf32",tree:"\ud83c\udf33","palm tree":"\ud83c\udf34",cactus:"\ud83c\udf35","sheaf of rice":"\ud83c\udf3e",herb:"\ud83c\udf3f","four leaf clover":"\ud83c\udf40",mushroom:"\ud83c\udf44",chestnut:"\ud83c\udf30"},S={void:0,ocean:10590,rock:14474460,sand:15719791,earth:32538},N=function(){function t(){Object(s.a)(this,t),this.world=void 0,this.hexes=void 0,this.container=void 0}return Object(h.a)(t,[{key:"init",value:function(t){this.hexes=[],this.world=t;var e,i,a=new d.b,n=Object(v.a)(t.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value,o={x:15*(i=r).x,y:f*(i.y+.5*(1&i.x))},l={group:new d.b,ground:new d.c,subText:new d.d("",{fontSize:20}),text:new d.d("",{fontSize:24})};l.text.scale.set(.5),l.text.anchor.set(.5),l.subText.scale.set(.4),l.subText.anchor.set(.5,0),l.subText.y=-1,l.group.position.set(o.x,o.y),l.group.addChild(l.ground,l.subText,l.text),a.addChild(l.group),this.hexes.push(l)}}catch(h){n.e(h)}finally{n.f()}var s=new d.c;s.lineStyle(2,16711680,1,1),s.drawRect(0,0,15*t.width+5,(t.height+.5)*f),s.position.set(-10,-f/2),a.addChild(s),this.container=a}},{key:"drawHex",value:function(t){var e=S[t.type],i=this.hexes[t.index],a=i.ground;if(a.clear(),a.beginFill(e,1),a.drawPolygon([-10,0,-5,f/2,5,f/2,10,0,5,-f/2,-5,-f/2]),a.endFill(),t.animal){var n=z[t.animal];i.text.text=n}else i.text.text="";if(t.plant){var r=P[t.plant];i.subText.text=r}else i.subText.text=""}},{key:"draw",value:function(){var t,e=Object(v.a)(this.world.cells);try{for(e.s();!(t=e.n()).done;){var i=t.value;"void"!==i.type&&this.drawHex(i)}}catch(a){e.e(a)}finally{e.f()}}}]),t}(),A=640,I=480,q=function(t){Object(c.a)(i,t);var e=Object(u.a)(i);function i(t){var a;return Object(s.a)(this,i),(a=e.call(this,t)).app=void 0,a.world=void 0,a.container=void 0,a.lastWorldTick=void 0,a.worldDrawer=void 0,a.tooltip=void 0,a.state=void 0,a.state={paused:!0,msPerTick:100,animal:"fish"},a}return Object(h.a)(i,[{key:"componentDidMount",value:function(){this.app=new d.a({width:A,height:I,antialias:!0}),document.querySelector("#canvas-zone").appendChild(this.app.view),this.app.ticker.add(this.animate.bind(this)),this.initWorld(),this.initUI(),this.worldDrawer.draw(),this.launchTicker()}},{key:"initUI",value:function(){var t=new T(this.container,this.worldDrawer.container,this.world);t.init(),this.tooltip=t}},{key:"initWorld",value:function(){var t=this;this.container=new d.b,this.container.sortableChildren=!0,this.app.stage.addChild(this.container),this.container.position.set(30,30),this.world=new D,this.world.setup(),this.worldDrawer=new N,this.worldDrawer.init(this.world),this.container.addChild(this.worldDrawer.container),this.worldDrawer.container.scale.set(1),this.worldDrawer.container.interactive=!0,this.worldDrawer.container.on("click",(function(e){var i=p(e.data.getLocalPosition(t.worldDrawer.container)),a=t.world.get(i.x,i.y);null!==a&&"void"!==a.type&&(a.animal=t.state.animal,t.worldDrawer.draw())}))}},{key:"launchTicker",value:function(){var t=this;setTimeout((function(){t.state.paused||t.tick(),t.launchTicker()}),this.state.msPerTick)}},{key:"tick",value:function(){this.world.tick(),this.worldDrawer.draw()}},{key:"animate",value:function(){this.app.ticker.deltaMS>=100&&console.log("too slow!")}},{key:"handlePause",value:function(){this.setState({paused:!this.state.paused})}},{key:"handleReset",value:function(){this.world.setup(),this.worldDrawer.draw(),this.setState({paused:!0})}},{key:"handleMsChange",value:function(t){this.setState({msPerTick:+t})}},{key:"handleAnimalChange",value:function(t){this.setState({animal:t})}},{key:"render",value:function(){var t=this;return n.a.createElement("div",{className:"App"},n.a.createElement("header",{className:"App-header"},n.a.createElement("h1",{className:"App-header-title"},"Ecomata")),n.a.createElement("div",{className:"App-content"},n.a.createElement("div",{id:"canvas-zone"}),n.a.createElement("div",{id:"controls"},n.a.createElement("button",{onClick:function(){return t.handlePause()}},this.state.paused?"Play":"Pause"),n.a.createElement("button",{onClick:function(){return t.handleReset()}},"Reset"),n.a.createElement("label",null,"ms per tick:",n.a.createElement("input",{type:"number",value:this.state.msPerTick,step:"10",onChange:function(e){return t.handleMsChange(e.target.value)}})),n.a.createElement("select",{value:this.state.animal,onChange:function(e){return t.handleAnimalChange(e.target.value)}},Object.entries(O).map((function(t){var e=Object(l.a)(t,2),i=e[0];e[1];return n.a.createElement("option",{key:i,label:"".concat(z[i]," ").concat(i),value:i})}))),n.a.createElement("button",{onClick:function(){return t.tick()}},"tick"))))}}]),i}(a.Component);o.a.render(n.a.createElement(q,null),document.getElementById("root"))}},[[21,1,2]]]);
//# sourceMappingURL=main.7f7e5d0e.chunk.js.map